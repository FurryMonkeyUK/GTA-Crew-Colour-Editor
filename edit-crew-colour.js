!(function(){function loadjQuery(a){var b=document.createElement("script");b.src="//code.jquery.com/jquery-1.11.1.min.js",b.onload=a,document.getElementsByTagName("head")[0].appendChild(b)}loadjQuery(function(){function a(a){return a=""+a,("00"+Number(a.trim()).toString(16)).substr(-2)}function b(b,c,d){return a(b)+a(c)+a(d)}CanvasRenderingContext2D.prototype.loadImage=function(a,b){var c=new Image;c.onload=function(){this.canvas.height=c.height,this.canvas.width=c.width,this.drawImage(c,0,0),"function"==typeof b&&b()}.bind(this),c.setAttribute("crossOrigin","Anonymous"),c.src="//www.furrymonkey.co.uk/_external/gta/getimage.aspx?src="+a};var d=function(a){if(s=0,a=a.split("#").join("").toLowerCase(),"rgb"==a.substr(0,3))a=a.split("(")[1].split(")")[0].split(","),a=b(a[0],a[1],a[2]);else if(a.length<6)return;return a="#"+a.substr(0,6),window._selectedColour=a,$(".minicolors-swatch-color").css("background-color",a),a};$("<link/>",{href:"https://raw.githubusercontent.com/FurryMonkeyUK/GTA-Crew-Colour-Editor/master/colpick.css?"+(new Date).getTime(),rel:"stylesheet",type:"text/css"}).appendTo("head"),$("<link/>",{href:"//raw.githubusercontent.com/FurryMonkeyUK/GTA-Crew-Colour-Editor/master/edit-crew-colour.css?"+(new Date).getTime(),rel:"stylesheet",type:"text/css"}).appendTo("head");var e=$("<div/>",{id:"edit-crew-colour-container"}),f=$("<div/>",{class:"dialog"}),g=$("<div/>",{class:"title",text:"Custom Crew Colour Editor"}),h=$("<div/>",{class:"colour-picker"}),i=$("<div/>",{class:"colour-picker-recent",title:"Recently used colours"}),j=$("<div/>",{class:"image-picker"}),k=$("<input/>",{class:"image-url",type:"text"}),l=$("<div/>",{class:"canvas-container"}),m=$("<canvas/>",{id:"image-canvas"}),n=$("<div/>",{class:"buttons"}),o=$("<button/>",{class:"btn-ok",text:"ok"}),p=$("<button/>",{class:"btn-cancel",text:"cancel"}),q=[];m.attr("height","0").attr("width","0").on("mousemove",function(a){function c(a){var b=0,c=0;if(a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}}}var d=c(this),e=a.pageX-d.x+l.scrollLeft(),f=a.pageY-d.y+l.scrollTop()-$(document).scrollTop(),h=r.getImageData(e,f,1,1).data,i=("000000"+b(h[0],h[1],h[2])).slice(-6);m.attr("current-colour",i),$(".colpick_new_color").css("background-color","#"+i)}).on("click",function(){h.colpickSetColor(m.attr("current-colour"),!0)}).on("mouseleave",function(){$(".colpick_new_color").css("background-color",$(".colpick_current_color").css("background-color"))}),l.append(m),k.attr("placeholder","Type or paste an image URL and press enter to load it below").on("focus",function(){$(this).select()}),j.append(k),j.append(l),o.on("click",function(){var a=$(".colpick_new_color").css("background-color");d(a),e.hide()}),p.on("click",function(){e.hide()}),n.append(o),n.append(p),h.append(i),f.append(g),f.append(h),f.append(j),f.append(n),e.append(f),$("body").append(e);var r=m[0].getContext("2d"),s=0;k.on("keypress",function(a){if(13==a.which){m.hide();var b=$("<h2/>",{text:"Loading image..."}).appendTo(l);r.loadImage(this.value,function(){b.remove(),m.show()})}});var t=function(){window._selectedColour=$("#createCrewFormColor")[0].getAttribute("value"),window._selectedColour.length>7&&(window._selectedColour=window._selectedColour.substr(0,7)),$(".minicolors-swatch-color").attr("style","background-color:"+window._selectedColour),h.colpick({flat:!0,layout:"full",submit:"false"});var a=function(){i.empty();for(var a=0,b=q.length;a<b;a++){q[a].length>7&&(q[a]=q[a].substr(0,7));var c=$("<div/>",{class:"colour-picker-recent-colour"});c.css("background-color",q[a]),i.append(c)}},b=function(b){b.length>7&&(b=b.substr(0,7)),q.indexOf(b)==-1&&(q.reverse(),q.push(b),q.reverse(),q.length>24&&(q=q.slice(0,24)),localStorage.setItem("crew-colours-recent",JSON.stringify(q)),a())};q=localStorage.getItem("crew-colours-recent"),q=null!=q?JSON.parse(q):[],a(),i.on("click",".colour-picker-recent-colour",function(){var a=$(this).css("background-color").split("#").join("");h.colpickSetColor(d(a),!0)});for(var c=$("#createCrewFormColor, #crewColor"),f=["","a","aa","f","ff","5","55","0","00"],g=function(a){f.indexOf(a)==-1&&f.push(a)},j=1;j<16;j++){var k=j.toString(16);g(k),g(k+k)}var l=f.length;$("#createCrewFormBtn").on("click",function(a){var d=function(a){var b=$(".spinnerv2");b.length?a():setTimeout(function(){d(a)},10)},e=function(a){var b=$(".spinnerv2");b.length?setTimeout(function(){e(a)},10):a()},g=function(){var a=$("#createCrewError");if(a.is(":visible")){var b="Cannot save crew colour ("+(s+1)+" of "+(l-1)+") - click to try next combination.";a.text(b);var c=$(".createCrewError"),d=c.find(".help-block");return d.length||(d=$("<p />",{class:"help-block"}).appendTo(c)),d.text(b),!1}return!0},h=function(){var a=window._selectedColour+f[s];c.val(a).attr("value",a),setTimeout(function(){d(function(){e(function(){g()?(s=0,b(a)):++s==l&&($("#createCrewError").text("Can't save crew colour."),s=0)})})},10)};h()});var m=$(".minicolors").closest(".input");m.on("mousedown",function(){return h.colpickSetColor(window._selectedColour,!0),e.show(),!1}).on("mouseup",function(){return!1}),window._customCrewScriptLoaded=!0,setTimeout(function(){m.trigger("mousedown")},100)},u=function(a){var b=$("#createCrewFormColor");b.length?a():setTimeout(function(){u(a)},250)};window._customCrewScriptLoaded!==!0?u(function(){$.getScript("//raw.githubusercontent.com/FurryMonkeyUK/GTA-Crew-Colour-Editor/master/colpick.js",function(){t()})}):$(".minicolors").closest(".input").trigger("mousedown")});})()
